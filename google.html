<script type="text/javascript">

    function oneditprepare() {
        const node = this;

        $.getJSON("google/apis/drive/info", function(data) {
            $('#node-input-operation').append(
                data.operations.map(function(d) {
                    let opt = $('<option></option>')
                        .attr('value', d)
                        .attr('selected', node.operation === d)
                        .text(d)
                        .wrap('<p/>');
                    return opt.parent().html();
                }).join(""));

            if (data.operations.indexOf(node.operation) < 0) {
                $('#node-input-dynamic-operation').attr('selected', true);
            };
        });
    }

    function label() {
        return this.name || "google";
    }

    RED.nodes.registerType('google', {
        category: 'function',
        color: '#FFCC66',
        icon: 'google.png',
        defaults: {
            name: { value: "" },
            google: {
                type: "google-drive-credentials",
                required: true
            },
            operation: { type: "" }
        },
        inputs: 1,
        outputs: 1,
        label: label,
        oneditprepare: oneditprepare
    });

</script>

<script type="text/html" data-template-name="google">

    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input id="node-input-name" type="text" placeholder="Name" />
    </div>

    <div class="form-row">
        <label for="node-input-google"><i class="fa fa-google"></i> Credentials</label>
        <input id="node-input-google" type="text" />
    </div>

    <div class="form-row">
        <label for="node-input-operation"><i class="fa fa-wrench"></i> Operation</label>
        <select id="node-input-operation" type="text" style="display: inline-block; vertical-align: top;">
        </select>
    </div>

</script>

<!-- <script type="text/html" data-help-name="google">
    <p>A node that calls method of Google API.</p>
    <p>API and operation selection can be made via node configuration or values passed in
        <b>msg.google.api</b>
        and/or
        <b>msg.google.operation</b>.</p>
    <p>Params for call are passed via
        <b>msg.payload</b>.</p>
    <p>The result is returned in
        <b>msg.payload</b>.</p>
    <p>See the
        <a href="https://github.com/google/google-api-nodejs-client" target="_blank">
            <i>google-api-nodejs-client</i>
        </a> and <a href="https://developers.google.com/discovery/" target="_blank"><i>Google API Discovery Service</i></a>
        for available APIs and operations.</p>
</script> -->
